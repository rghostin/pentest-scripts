#!/usr/bin/bash

set -o errexit # abort on nonzero exitstatus
set -o nounset # abort on unbound variable

PROBES=2
TIMEOUT=2

function test_host {
  ping -c $PROBES -w $TIMEOUT "${ip}"  2>&1 > /dev/null

  if [ $? -eq 0 ]; then
	echo "${ip}"
  fi
}


if [ "$#" -ne "1" ]; then
    echo "Usage: ${0} <range>"
    echo "	<range>  /24 IP range, eg 192.168.0"
    exit 1
fi

base_range="${1}"

for host in $(seq 1 254); do
  ip="${base_range}.${host}"
  test_host "${ip}" &
done

wait	# wait for all background processes

echo "Done"